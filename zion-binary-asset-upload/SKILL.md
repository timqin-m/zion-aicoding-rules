---
description: "Upload and manage binary assets (images, videos, files) with Zion.app backend. Use when: (1) Uploading files to Zion storage, (2) Getting CDN URLs for media, (3) Optimizing and converting images, (4) Managing file metadata, (5) Controlling resource access permissions"
alwaysApply: false
---
# Zion.app: Binary Asset Upload Protocol

This document describes the required protocol for uploading and referencing binary assets (images, videos, files) with Zion.app backend.

## Overview
All binary assets (images, videos, files) are stored on object storage services (e.g., S3). Their storage path is recorded in Zion's database. **When referencing these assets in other tables, you must store only the asset's Zion ID, not its path or URL.**

## Upload Workflow
To upload a binary asset and obtain its Zion ID, you must follow a strict two-step process:

### Step 1: Obtain a Presigned Upload URL
1. **Calculate the MD5 hash** of the file (raw 128-bit hash), then Base64-encode it.
2. **Call the appropriate GraphQL mutation** to request a presigned upload URL. Use the mutation that matches your asset type:

   - `imagePresignedUrl` for images
   - `videoPresignedUrl` for videos
   - `filePresignedUrl` for other files

   Provide:
   - The Base64-encoded MD5 hash
   - The file format/suffix (see `MediaFormat` below)
   - (Optional) Access control (see `CannedAccessControlList` below)

   #### Example GraphQL Mutations
   ```graphql
   mutation GetImageUploadUrl($md5: String!, $suffix: MediaFormat!, $acl: CannedAccessControlList) {
     imagePresignedUrl(imgMd5Base64: $md5, imageSuffix: $suffix, acl: $acl) {
       imageId
       uploadUrl
       uploadHeaders
     }
   }

   mutation GetVideoUploadUrl($md5: String!, $format: MediaFormat!, $acl: CannedAccessControlList) {
     videoPresignedUrl(videoMd5Base64: $md5, videoFormat: $format, acl: $acl) {
       videoId
       uploadUrl
       uploadHeaders
     }
   }

   mutation GetFileUploadUrl($md5: String!, $format: MediaFormat!, $name: String, $suffix: String, $sizeBytes: Int, $acl: CannedAccessControlList) {
     filePresignedUrl(
       md5Base64: $md5
       format: $format
       name: $name
       suffix: $suffix
       sizeBytes: $sizeBytes
       acl: $acl
     ) {
       fileId
       uploadHeaders
       uploadUrl
     }
   }
   ```

   - **`CannedAccessControlList`** (recommended: `PRIVATE`):
     - AUTHENTICATE_READ, AWS_EXEC_READ, BUCKET_OWNER_FULL_CONTROL, BUCKET_OWNER_READ, DEFAULT, LOG_DELIVERY_WRITE, PRIVATE, PUBLIC_READ, PUBLIC_READ_WRITE
   - **`MediaFormat`**:
     - CSS, CSV, DOC, DOCX, GIF, HTML, ICO, JPEG, JPG, JSON, MOV, MP3, MP4, OTHER, PDF, PNG, PPT, PPTX, SVG, TXT, WAV, WEBP, XLS, XLSX, XML

### Step 2: Upload the File and Use the Returned ID
1. The mutation response includes:
   - The asset's unique ID (`imageId`, `videoId`, or `fileId`)
   - A presigned `uploadUrl`
   - Any required `uploadHeaders`
2. **Upload the file**:
   - Perform an HTTP `PUT` request to the `uploadUrl` with the raw file data
   - Include any `uploadHeaders` from the mutation response
3. **Reference the asset**:
   - Use the returned ID as the value for the corresponding `*_id` field in your Zion data mutation (e.g., `cover_image_id: returnedImageId`)

> **Note:** This two-step process is **mandatory** for all media uploads in Zion.app.
